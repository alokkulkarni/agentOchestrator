# Routing Rules Configuration
# Rules are evaluated in priority order (highest first)
# When a rule matches, the specified agents are called

rules:
  # ============================================================================
  # EXCLUSION RULES - Highest Priority (110+)
  # These catch queries that should NOT be handled by any agent
  # ============================================================================
  
  # Rule to explicitly reject unsupported queries
  - name: "unsupported_queries"
    priority: 110
    conditions:
      # Customer service queries
      - field: "query"
        operator: "contains"
        value: "change my address"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "update my address"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "change address"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "update address"
        case_sensitive: false
      # Account management
      - field: "query"
        operator: "contains"
        value: "change my password"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "reset password"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "update my profile"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "change my email"
        case_sensitive: false
      # Customer service
      - field: "query"
        operator: "contains"
        value: "speak to representative"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "talk to agent"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "customer service"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "call center"
        case_sensitive: false
      # Financial transactions (account-specific)
      # Balance queries - catch all variations
      - field: "query"
        operator: "contains"
        value: "check my balance"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "check balance"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "my balance"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "account balance"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "current balance"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "show balance"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "know my balance"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "want to check"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "want to know"
        case_sensitive: false
      # Account viewing
      - field: "query"
        operator: "contains"
        value: "view my account"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "view account"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "see my account"
        case_sensitive: false
      # Money transfer
      - field: "query"
        operator: "contains"
        value: "transfer money"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "send money"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "make payment"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "pay bill"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "pay my"
        case_sensitive: false
      # Transaction history
      - field: "query"
        operator: "contains"
        value: "transaction history"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "recent transactions"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "transaction"
        case_sensitive: false
      # Credit card account queries (personal)
      - field: "query"
        operator: "contains"
        value: "my credit card balance"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "credit card balance"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "my credit card"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "my card balance"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "card balance"
        case_sensitive: false
    logic: "or"  # Match if ANY condition is true
    target_agents: []  # Empty list = no agents
    confidence: 1.0  # 100% confident these shouldn't be handled
    enabled: true

  # ============================================================================
  # CAPABILITY-BASED RULES (100-109)
  # These match specific agent capabilities
  # ============================================================================
  
  # High-priority rule for math/calculation queries
  - name: "math_queries"
    priority: 100
    conditions:
      - field: "query"
        operator: "contains"
        value: "calculate"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "add"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "subtract"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "multiply"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "divide"
        case_sensitive: false
      - field: "query"
        operator: "regex"
        value: "\\d+\\s*[+\\-*/]\\s*\\d+"
        case_sensitive: false
      - field: "operands"
        operator: "exists"
        value: null
        case_sensitive: false
    logic: "or"  # Match if ANY condition is true
    target_agents:
      - "calculator"
    confidence: 0.95
    enabled: true

  # Rule for web/internet search queries (Tavily)
  - name: "web_search_queries"
    priority: 95
    conditions:
      - field: "query"
        operator: "contains"
        value: "web search"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "internet search"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "online"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "latest"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "current"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "real-time"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "news"
        case_sensitive: false
    logic: "or"
    target_agents:
      - "tavily_search"
    confidence: 0.90
    enabled: true

  # Rule for search/retrieval queries (local documents)
  - name: "search_queries"
    priority: 90
    conditions:
      - field: "query"
        operator: "contains"
        value: "search"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "find"
        case_sensitive: false
    logic: "or"
    target_agents:
      - "search"
    confidence: 0.85
    enabled: true

  # Rule for trip/travel planning queries (high priority)
  - name: "trip_planning_queries"
    priority: 99
    conditions:
      - field: "query"
        operator: "contains"
        value: "plan a trip"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "plan trip"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "travel plan"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "itinerary"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "route from"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "journey from"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "travel from"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "points of interest"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "road trip"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "drive from"
        case_sensitive: false
      - field: "query"
        operator: "regex"
        value: "from\\s+\\w+\\s+to\\s+\\w+"
        case_sensitive: false
    logic: "or"  # Match if ANY condition is true
    target_agents:
      - "search"
      - "tavily_search"
    execution_mode: "sequential"  # Search first, orchestrator synthesizes
    confidence: 0.95
    enabled: true

  # Rule for software development planning queries (disabled - orchestrator synthesizes)
  - name: "planning_queries"
    priority: 98
    conditions:
      - field: "query"
        operator: "contains"
        value: "application plan"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "project plan"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "software plan"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "build an app"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "build a web"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "build a mobile"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "create an app"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "create a website"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "design application"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "design system"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "develop application"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "develop software"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "trip itinerary"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "travel itinerary"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "plan a trip"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "plan my trip"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "itinerary from"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "requirements"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "user stories"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "user story"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "epics"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "epic"
        case_sensitive: false
      - field: "requirements"
        operator: "exists"
        value: null
        case_sensitive: false
    logic: "or"
    target_agents:
      - "search"
      - "tavily_search"
    confidence: 0.90
    enabled: false  # Disabled - orchestrator handles synthesis

  # Rule for tech insights queries
  - name: "tech_insights_queries"
    priority: 92
    conditions:
      - field: "query"
        operator: "contains"
        value: "insights"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "trends"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "top 20"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "software engineering"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "tech trends"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "technology trends"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "programming trends"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "ai trends"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "ml trends"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "latest in tech"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "what's new"
        case_sensitive: false
    logic: "or"
    target_agents:
      - "tech_insights"
    confidence: 0.92
    enabled: true

  # Rule for weather-related queries
  - name: "weather_queries"
    priority: 85
    conditions:
      - field: "query"
        operator: "contains"
        value: "weather"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "forecast"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "temperature"
        case_sensitive: false
    logic: "or"
    target_agents:
      - "weather"
    confidence: 0.90
    enabled: true

  # Rule for data transformation queries (HIGH PRIORITY - checks for data field)
  - name: "data_processing"
    priority: 105
    conditions:
      - field: "data"
        operator: "exists"
        value: null
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "transform"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "process"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "filter"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "aggregate"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "group"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "employee data"
        case_sensitive: false
      - field: "query"
        operator: "contains"
        value: "data processor"
        case_sensitive: false
    logic: "or"
    target_agents:
      - "data_processor"
    confidence: 0.95
    enabled: true

  # Catch-all rule with low priority (uses multiple agents)
  - name: "general_query"
    priority: 10
    conditions:
      - field: "query"
        operator: "exists"
        value: null
        case_sensitive: false
    logic: "and"
    target_agents:
      - "search"
      - "calculator"
    confidence: 0.5
    enabled: false  # Disabled by default to avoid unnecessary agent calls
