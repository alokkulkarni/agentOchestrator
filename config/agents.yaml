# Agent Definitions with Roles and Constraints
# This file defines all available agents with their roles, capabilities, and guardrails

agents:
  # ============================================================================
  # CALCULATOR AGENT - Restricted role with guardrails
  # ============================================================================
  - name: "calculator"
    type: "direct"
    direct_tool:
      module: "examples.sample_calculator"
      function: "calculate"
      is_async: false

    capabilities:
      - "math"
      - "calculation"
      - "arithmetic"

    # Role definition with constraints
    role:
      name: "math-processor"
      description: "Performs mathematical calculations with strict input validation"
      allowed_operations:
        - "add"
        - "subtract"
        - "multiply"
        - "divide"
        - "power"
        - "sqrt"
      denied_operations:
        - "exec"  # No code execution
        - "eval"  # No eval
      max_execution_time: 5  # 5 seconds max
      max_input_size: 10000  # 10KB max input
      require_approval: false
      guardrails:
        max_operands: 100  # Max 100 numbers in calculation
        min_operand_value: -1000000
        max_operand_value: 1000000
        allow_division_by_zero: false

    # Execution constraints
    constraints:
      max_retries: 2
      timeout: 5
      rate_limit: 60  # 60 calls per minute
      require_validation: false
      allowed_input_fields:
        - "operation"
        - "operands"
        - "query"
        - "parameters"
      denied_input_fields:
        - "code"
        - "script"
        - "command"
      output_sanitization: true
      log_level: "INFO"

    fallback: null
    enabled: true
    metadata:
      description: "Safe mathematical calculator with input validation"
      version: "1.0.0"
      owner: "system"

  # ============================================================================
  # SEARCH AGENT - Open role with logging
  # ============================================================================
  - name: "search"
    type: "direct"
    direct_tool:
      module: "examples.sample_search"
      function: "search_documents"
      is_async: true

    capabilities:
      - "search"
      - "retrieval"
      - "query"
      - "information"

    # Role definition - more permissive
    role:
      name: "information-retriever"
      description: "Searches and retrieves information from documents"
      allowed_operations:
        - "*"  # All operations allowed
      denied_operations:
        - "delete"  # No deletion
        - "modify"  # No modification
      max_execution_time: 10
      max_input_size: 50000  # 50KB
      require_approval: false
      guardrails:
        max_results: 100
        min_relevance_score: 0.0
        allow_fuzzy_search: true
        safe_search: true  # Filter inappropriate content

    constraints:
      max_retries: 3
      timeout: 10
      rate_limit: 30  # 30 calls per minute
      require_validation: false
      allowed_input_fields:
        - "*"  # All fields allowed
      denied_input_fields:
        - "admin"
        - "password"
        - "secret"
      output_sanitization: true
      log_level: "DEBUG"  # More detailed logging

    fallback: null
    enabled: true
    metadata:
      description: "Document search with safe search enabled"
      version: "1.0.0"
      index_size: "1000 documents"

  # ============================================================================
  # TAVILY SEARCH AGENT - AI-powered web search
  # ============================================================================
  - name: "tavily_search"
    type: "direct"
    direct_tool:
      module: "examples.sample_tavily_search"
      function: "get_tavily_search"
      is_async: false  # Using sync wrapper

    capabilities:
      - "web-search"
      - "real-time-search"
      - "ai-search"
      - "internet"
      - "research"

    # Role definition - external API with rate limits
    role:
      name: "web-researcher"
      description: "AI-powered web search using Tavily API"
      allowed_operations:
        - "search"
        - "query"
        - "research"
      denied_operations:
        - "scrape"  # No web scraping
        - "crawl"   # No crawling
        - "download"  # No file downloads
      max_execution_time: 30  # Network calls may take time
      max_input_size: 10000
      require_approval: false
      guardrails:
        max_results: 20  # API limit
        safe_search: true  # Filter inappropriate content
        require_valid_query: true
        cache_results: true
        cache_ttl: 3600  # 1 hour cache

    constraints:
      max_retries: 2
      timeout: 30
      rate_limit: 10  # Respect Tavily API limits (depends on plan)
      require_validation: false
      allowed_input_fields:
        - "query"
        - "search_depth"
        - "max_results"
        - "include_domains"
        - "exclude_domains"
        - "include_answer"
        - "include_images"
      denied_input_fields:
        - "api_key"  # API key from environment only
        - "credentials"
      output_sanitization: true
      log_level: "INFO"

    fallback: "search"  # Fallback to local search if Tavily fails
    enabled: true
    metadata:
      description: "AI-powered web search via Tavily API"
      version: "1.0.0"
      api_provider: "tavily"
      api_docs: "https://docs.tavily.com/"
      requires_api_key: true
      env_var: "TAVILY_API_KEY"

  # ============================================================================
  # DATA PROCESSOR - Restricted with validation required
  # ============================================================================
  - name: "data_processor"
    type: "direct"
    direct_tool:
      module: "examples.sample_data_processor"
      function: "process_data"
      is_async: false

    capabilities:
      - "data"
      - "transform"
      - "json"
      - "csv"
      - "processing"

    # Strict role for data processing
    role:
      name: "data-transformer"
      description: "Transforms and processes structured data with validation"
      allowed_operations:
        - "transform"
        - "filter"
        - "aggregate"
        - "sort"
      denied_operations:
        - "delete_all"
        - "drop_database"
        - "truncate"
      max_execution_time: 30  # 30 seconds for large datasets
      max_input_size: 1000000  # 1MB max
      require_approval: false
      guardrails:
        max_records: 10000  # Max 10K records
        max_field_size: 10000  # Max 10KB per field
        allow_nested_data: true
        max_nesting_depth: 5

    constraints:
      max_retries: 2
      timeout: 30
      rate_limit: 20  # 20 calls per minute
      require_validation: true  # Must validate output
      allowed_input_fields:
        - "data"
        - "operation"
        - "filters"
        - "query"
      denied_input_fields:
        - "raw_sql"
        - "query_string"
        - "script"
      output_sanitization: true
      log_level: "INFO"

    fallback: null
    enabled: true
    metadata:
      description: "Data processing with strict validation"
      version: "1.0.0"
      supported_formats: ["json", "dict"]

  # ============================================================================
  # MCP CALCULATOR - Example MCP server demonstrating MCP protocol
  # ============================================================================
  # NOTE: Disabled by default - requires MCP server running
  # To enable:
  #   1. Start MCP server in terminal 1: python examples/sample_mcp_server.py --http
  #   2. Set enabled to true below
  #   3. Restart orchestrator in terminal 2
  # Or use stdio transport (no HTTP server needed):
  #   1. Set MCP_CALC_URL=stdio in .env
  #   2. Set enabled to true
  #   3. Orchestrator will launch server as subprocess
  - name: "mcp_calculator"
    type: "mcp"
    connection:
      url: "${MCP_CALC_URL:http://localhost:8080}"  # HTTP or stdio
      timeout: 30
      headers: {}

    capabilities:
      - "math"
      - "calculation"
      - "mcp-example"
      - "arithmetic"

    role:
      name: "mcp-calculator"
      description: "Calculator via MCP protocol (demonstrat example)"
      allowed_operations:
        - "add"
        - "subtract"
        - "multiply"
        - "divide"
      denied_operations: []
      max_execution_time: 10
      max_input_size: 1000
      require_approval: false
      guardrails:
        validate_numbers: true
        prevent_divide_by_zero: true

    constraints:
      max_retries: 2
      timeout: 10
      rate_limit: 30  # Local server, higher limit
      require_validation: true
      allowed_input_fields:
        - "a"
        - "b"
        - "operation"
        - "query"
      denied_input_fields: []
      output_sanitization: true
      log_level: "INFO"

    fallback: "calculator"  # Fallback to direct calculator
    enabled: true  # ENABLED for demo
    metadata:
      description: "MCP calculator server demonstrating MCP protocol"
      version: "1.0.0"
      transport: "http or stdio"
      server_file: "examples/sample_mcp_server.py"

  # ============================================================================
  # WEATHER AGENT (Direct) - Simple weather lookups
  # ============================================================================
  - name: "weather"
    type: "direct"
    direct_tool:
      module: "examples.sample_weather"
      function: "get_weather"
      is_async: false

    capabilities:
      - "weather"
      - "forecast"
      - "climate"
      - "temperature"
      - "conditions"

    role:
      name: "weather-info"
      description: "Provides weather information for locations worldwide"
      allowed_operations:
        - "get_weather"
        - "get_forecast"
        - "check_conditions"
      denied_operations:
        - "set_weather"
        - "modify"
      max_execution_time: 10
      max_input_size: 1000
      require_approval: false
      guardrails:
        require_valid_location: true

    constraints:
      max_retries: 2
      timeout: 10
      rate_limit: 30
      require_validation: false
      allowed_input_fields:
        - "location"
        - "city"
        - "units"
        - "include_forecast"
      denied_input_fields:
        - "api_key"
        - "credentials"
      output_sanitization: true
      log_level: "INFO"

    fallback: "tavily_search"
    enabled: true  # Uses mock data if no API key
    metadata:
      description: "Weather information with optional OpenWeatherMap API"
      version: "1.0.0"
      api_provider: "openweathermap"
      note: "Uses mock data if OPENWEATHER_API_KEY not set"

  # ============================================================================
  # TECH INSIGHTS AGENT - AI-powered software engineering trends analysis
  # ============================================================================
  - name: "tech_insights"
    type: "direct"
    direct_tool:
      module: "examples.sample_tech_insights"
      function: "get_tech_insights"
      is_async: false

    capabilities:
      - "insights"
      - "trends"
      - "technology"
      - "software-engineering"
      - "ai"
      - "ml"
      - "programming"
      - "tools"
      - "education"

    # AI-powered role with validation and quality checks
    role:
      name: "tech-advisor-ai"
      description: "Provides industry-wide technology trends, software engineering insights, and technology landscape analysis. NOT for project-specific technology recommendations - use planning agent for that."
      allowed_operations:
        - "get_insights"
        - "generate_insights_with_ai"
        - "validate_insights"
        - "filter_by_category"
        - "filter_by_audience"
      denied_operations:
        - "modify_curated_insights"
        - "delete_insights"
        - "override_validation"
      max_execution_time: 60  # AI generation takes longer
      max_input_size: 5000
      require_approval: false
      guardrails:
        # Content guardrails
        min_insights: 10
        max_insights: 20
        required_categories: ["ai", "languages", "tools", "ml"]
        required_fields: ["rank", "title", "category", "technical", "non_technical", "impact", "adoption", "source"]

        # Quality guardrails
        min_technical_length: 100
        max_technical_length: 800
        min_non_technical_length: 50
        max_non_technical_length: 600

        # Validation guardrails
        validate_before_response: true
        min_quality_score: 0.8
        fallback_on_validation_failure: true

        # Content quality
        require_specific_examples: true
        require_factual_data: true
        no_speculation: true
        include_both_perspectives: true

    constraints:
      max_retries: 2
      timeout: 60  # AI calls need more time
      rate_limit: 10  # Lower rate limit due to AI costs
      require_validation: true  # MUST validate AI output
      allowed_input_fields:
        - "category"
        - "audience"
        - "query"
        - "refresh"  # Allow AI refresh
        - "gateway_url"
      denied_input_fields:
        - "admin"
        - "override"
        - "bypass_validation"
      output_sanitization: false  # Educational content, no sanitization needed
      log_level: "INFO"

    fallback: null  # Has internal fallback to curated insights
    enabled: true
    metadata:
      description: "Provides industry technology trends and software engineering insights - NOT for project-specific tech recommendations"
      version: "2026.1"
      categories: ["ai", "ml", "languages", "tools"]
      update_frequency: "on-demand with AI, monthly for curated"
      ai_powered: true
      model_gateway_required: true
      validation_enabled: true
      fallback_strategy: "curated insights on validation failure"

  # ============================================================================
  # PLANNING AGENT - AI-powered application planning with epics and user stories
  # ============================================================================
  - name: "planning"
    type: "direct"
    direct_tool:
      module: "examples.sample_planning_agent"
      function: "create_application_plan"
      is_async: false

    capabilities:
      - "project-planning"
      - "application-planning"
      - "requirements-planning"
      - "epic-creation"
      - "user-story-creation"
      - "software-planning"
      - "product-planning"
      - "trip-planning"
      - "itinerary-planning"
      - "travel-planning"

    # Strict role for planning with validation
    role:
      name: "application-planner"
      description: "Creates structured plans including software development plans (with epics/user stories) and travel itineraries. Works with search agents to gather information and create detailed plans. Supports both software planning and trip/travel planning."
      allowed_operations:
        - "plan_application"
        - "validate_requirements"
        - "generate_epics"
        - "create_user_stories"
        - "save_plan_document"
      denied_operations:
        - "execute_code"
        - "deploy"
        - "modify_existing_plans"
        - "delete_files"
      max_execution_time: 120  # 2 minutes for AI planning
      max_input_size: 50000  # 50KB max requirements
      require_approval: false
      guardrails:
        require_requirements: true
        validate_before_response: true
        no_hallucination: true
        ask_clarification_when_unclear: true
        technology_agnostic: true
        save_audit_trail: true
        max_epics: 10
        max_stories_per_epic: 15
        min_acceptance_criteria: 2

    constraints:
      max_retries: 2
      timeout: 120  # AI planning can take time
      rate_limit: 10  # 10 plans per minute
      require_validation: true  # Must validate plan against requirements
      allowed_input_fields:
        - "requirements"
        - "query"
        - "app_type"
        - "clarifications"
        - "gateway_url"
      denied_input_fields:
        - "code"
        - "script"
        - "command"
        - "override"
      output_sanitization: true
      log_level: "INFO"

    fallback: null
    enabled: false  # Disabled - orchestrator handles planning internally
    metadata:
      description: "AI-powered planning agent that creates detailed application plans with epics and user stories - DISABLED: Orchestrator synthesizes responses internally"
      version: "1.0.0"
      output_format: "markdown document"
      validation: "AI-validated against requirements"
      storage: "application_plans/ directory"
      interactive: true  # Can ask for clarification
      model_dependency: "Requires model gateway"
      note: "This agent is disabled because planning/synthesis should happen internally in the orchestrator, not as an external agent call"

  # ============================================================================
  # WEATHER AGENT (MCP) - Example MCP server with weather data
  # ============================================================================
  # NOTE: Disabled by default - requires MCP server running
  # To enable:
  #   1. Start the weather MCP server: python examples/sample_weather_server.py
  #   2. Set enabled to true
  #   3. Restart orchestrator
  - name: "weather_mcp"
    type: "mcp"
    connection:
      url: "${MCP_WEATHER_URL:stdio}"  # Use stdio transport for local testing
      timeout: 30
      headers: {}

    capabilities:
      - "weather"
      - "forecast"
      - "climate"
      - "external-api"

    # Role for external API calls
    role:
      name: "weather-provider"
      description: "Provides weather information via external API"
      allowed_operations:
        - "get_weather"
        - "get_forecast"
      denied_operations:
        - "set_weather"  # No write operations
        - "delete"
      max_execution_time: 15  # Network calls may take longer
      max_input_size: 5000
      require_approval: false
      guardrails:
        cache_results: true
        cache_ttl: 300  # 5 minutes
        require_valid_location: true

    constraints:
      max_retries: 3
      timeout: 15
      rate_limit: 10  # 10 calls per minute (respect API limits)
      require_validation: false
      allowed_input_fields:
        - "city"
        - "location"
        - "coordinates"
        - "query"
      denied_input_fields:
        - "api_key"  # Don't accept API key in input
        - "credentials"
      output_sanitization: true
      log_level: "INFO"

    fallback: null
    enabled: false  # Disabled - no MCP server running
    metadata:
      description: "Weather data via external API (mock)"
      version: "1.0.0"
      api_provider: "mock"

  # ============================================================================
  # ADMIN AGENT - High privilege role requiring approval
  # ============================================================================
  - name: "admin_agent"
    type: "direct"
    direct_tool:
      module: "examples.sample_admin"
      function: "get_system_status"  # Default function (agent has multiple)
      is_async: false

    capabilities:
      - "admin"
      - "privileged"
      - "system"
      - "monitoring"
      - "user_management"

    # Restricted admin role requiring human approval
    role:
      name: "system-administrator"
      description: "Administrative operations requiring human approval"
      allowed_operations:
        - "get_system_status"
        - "list_users"
        - "analyze_logs"
        - "generate_report"
        - "restart_service"
        - "update_user_permissions"
        - "clear_cache"
      denied_operations:
        - "delete_database"
        - "modify_system_config"
        - "shutdown_system"
        - "delete_user"
      max_execution_time: 60
      max_input_size: 10000
      require_approval: true  # REQUIRES HUMAN APPROVAL
      guardrails:
        require_audit_log: true
        require_justification: true
        allowed_users: ["admin", "supervisor"]

    constraints:
      max_retries: 1  # No auto-retry for admin operations
      timeout: 60
      rate_limit: 5  # Very limited rate
      require_validation: true
      allowed_input_fields:
        - "operation"
        - "parameters"
        - "justification"
      denied_input_fields:
        - "bypass"
        - "override"
      output_sanitization: true
      log_level: "WARNING"  # Log everything

    fallback: null
    enabled: false  # Disabled by default
    metadata:
      description: "Administrative agent with strict controls"
      version: "1.0.0"
      risk_level: "high"
      requires_approval: true

# ============================================================================
# ROLE TEMPLATES - Reference for creating new agents
# ============================================================================
#
# Role Names:
#   - data-analyst: Read-only data analysis
#   - code-reviewer: Code review and quality checks
#   - content-generator: Content creation
#   - system-monitor: System monitoring and alerts
#   - security-scanner: Security vulnerability scanning
#
# Constraint Levels:
#   - Low: rate_limit > 30, timeout > 30s, require_approval: false
#   - Medium: rate_limit 10-30, timeout 10-30s, require_validation: true
#   - High: rate_limit < 10, timeout < 10s, require_approval: true
#
# Guardrails Examples:
#   - max_records: Limit data processing
#   - allowed_domains: Restrict network access
#   - content_filter: Filter inappropriate content
#   - pii_detection: Detect and block PII
#   - cost_limit: Limit API costs
